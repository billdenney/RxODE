<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Matthew L. Fidler, Melissa Hallow, and Wenping Wang" />

<meta name="date" content="2018-02-22" />

<title>Introduction to RxODE</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to RxODE</h1>
<h4 class="author"><em>Matthew L. Fidler, Melissa Hallow, and Wenping Wang</em></h4>
<h4 class="date"><em>2018-02-22</em></h4>



<div id="rxode-a-tool-for-performing-simulations-from-ordinary-differential-equation-ode-models-with-applications-for-pharmacometrics" class="section level2">
<h2>RxODE: A tool for performing simulations from Ordinary Differential Equation (ODE) models, with applications for pharmacometrics</h2>
<hr />
<div id="authors-matthew-l.-fidler-melissa-hallow-and-wenping-wang" class="section level5">
<h5>Authors: Matthew L. Fidler, Melissa Hallow, and Wenping Wang</h5>
<hr />
</div>
<div id="introduction" class="section level4">
<h4>Introduction</h4>
<p><code>RxODE</code> is an R package that facilitates simulation with ODE models in R. It is designed with pharmacometrics models in mind, but can be applied more generally to any ODE model.</p>
<hr />
</div>
<div id="description-of-rxode-illustrated-through-an-example" class="section level4">
<h4>Description of RxODE illustrated through an example</h4>
<p>The model equations are specified through a text string in R. Both differential and algebraic equations are permitted. Differential equations are specified by <code>d/dt(var_name) =</code>. Each equation can be separated by a semicolon.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ode &lt;-<span class="st"> &quot;</span>
<span class="st">   C2 = centr/V2;</span>
<span class="st">   C3 = peri/V3;</span>
<span class="st">   d/dt(depot) =-KA*depot;</span>
<span class="st">   d/dt(centr) = KA*depot - CL*C2 - Q*C2 + Q*C3;</span>
<span class="st">   d/dt(peri)  =                    Q*C2 - Q*C3;</span>
<span class="st">   d/dt(eff)  = Kin - Kout*(1-C2/(EC50+C2))*eff;</span>
<span class="st">&quot;</span></code></pre></div>
<p>To load <code>RxODE</code> package and compile the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RxODE)
work &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="st">&quot;Rx_intro-&quot;</span>)
mod1 &lt;-<span class="st"> </span><span class="kw">RxODE</span>(<span class="dt">model =</span> ode, <span class="dt">modName =</span> <span class="st">&quot;mod1&quot;</span>, <span class="dt">wd =</span> work)</code></pre></div>
<div id="specify-ode-parameters-and-initial-conditions" class="section level5">
<h5>Specify ODE parameters and initial conditions</h5>
<p>Model parameters can be defined as named vectors. Names of parameters in the vector must be a superset of parameters in the ODE model, and the order of parameters within the vector is not important.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">theta &lt;-<span class="st"> </span>
<span class="st">   </span><span class="kw">c</span>(<span class="dt">KA=</span><span class="fl">2.94E-01</span>, <span class="dt">CL=</span><span class="fl">1.86E+01</span>, <span class="dt">V2=</span><span class="fl">4.02E+01</span>, <span class="co"># central </span>
     <span class="dt">Q=</span><span class="fl">1.05E+01</span>,  <span class="dt">V3=</span><span class="fl">2.97E+02</span>,              <span class="co"># peripheral</span>
     <span class="dt">Kin=</span><span class="dv">1</span>, <span class="dt">Kout=</span><span class="dv">1</span>, <span class="dt">EC50=</span><span class="dv">200</span>)               <span class="co"># effects</span></code></pre></div>
<p>Initial conditions (ICs) are defined through a vector as well. If the vector is not named, the number of ICs must equal exactly the number of ODEs in the model, and the order must be the same as the order in which the ODEs are listed in the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inits &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</code></pre></div>
<p>When elements are named, missing elements are added and set to zero. Also when named, the order of initilizations does not matter. Therefore the following code is an equvalent initialization as the code above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inits &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">eff=</span><span class="dv">1</span>);</code></pre></div>
</div>
<div id="specify-dosing-and-sampling-in-rxode" class="section level5">
<h5>Specify Dosing and sampling in RxODE</h5>
<p><code>RxODE</code> provides a simple and very flexible way to specify dosing and sampling through functions that generate an event table. First, an empty event table is generated through the “eventTable()” function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">'mg'</span>, <span class="dt">time.units=</span><span class="st">'hours'</span>)</code></pre></div>
<p>Next, use the <code>add.dosing()</code> and <code>add.sampling()</code> functions of the <code>EventTable</code> object to specify the dosing (amounts, frequency and/or times, etc.) and observation times at which to sample the state of the system. These functions can be called multiple times to specify more complex dosing or sampling regiments. Here, these functions are used to specify 10mg BID dosing for 5 days, followed by 20mg QD dosing for 5 days:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">10</span>, <span class="dt">dosing.interval=</span><span class="dv">12</span>)
ev<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">20000</span>, <span class="dt">nbr.doses=</span><span class="dv">5</span>, <span class="dt">start.time=</span><span class="dv">120</span>, <span class="dt">dosing.interval=</span><span class="dv">24</span>)
ev<span class="op">$</span><span class="kw">add.sampling</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">240</span>)</code></pre></div>
<p>If you wish you can also do this with the <code>mattigr</code> pipe operator <code>%&gt;%</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">10</span>, <span class="dt">dosing.interval=</span><span class="dv">12</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">20000</span>, <span class="dt">nbr.doses=</span><span class="dv">5</span>, <span class="dt">start.time=</span><span class="dv">120</span>,<span class="dt">dosing.interval=</span><span class="dv">24</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">240</span>);</code></pre></div>
<p>The functions <code>get.dosing()</code> and <code>get.sampling()</code> can be used to retrieve information from the event table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ev<span class="op">$</span><span class="kw">get.dosing</span>())</code></pre></div>
<pre><code>##   time evid   amt
## 1    0  101 10000
## 2   12  101 10000
## 3   24  101 10000
## 4   36  101 10000
## 5   48  101 10000
## 6   60  101 10000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ev<span class="op">$</span><span class="kw">get.sampling</span>())</code></pre></div>
<pre><code>##    time evid amt
## 16    0    0  NA
## 17    1    0  NA
## 18    2    0  NA
## 19    3    0  NA
## 20    4    0  NA
## 21    5    0  NA</code></pre>
</div>
<div id="solving-odes" class="section level5">
<h5>Solving ODEs</h5>
<p>The ODE can now be solved by calling the model object’s <code>run</code> or <code>solve</code> function. Simulation results for all variables in the model are stored in the output matrix x.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mod1<span class="op">$</span><span class="kw">solve</span>(theta, ev, inits)
<span class="kw">head</span>(x)</code></pre></div>
<pre><code>##      time     depot    centr      peri      eff       C2        C3
## [1,]    0 10000.000    0.000    0.0000 1.000000  0.00000 0.0000000
## [2,]    1  7452.765 1783.897  273.1895 1.084664 44.37555 0.9198298
## [3,]    2  5554.370 2206.295  793.8758 1.180825 54.88296 2.6729825
## [4,]    3  4139.542 2086.518 1323.5783 1.228914 51.90343 4.4564927
## [5,]    4  3085.103 1788.795 1776.2702 1.234610 44.49738 5.9807076
## [6,]    5  2299.255 1466.670 2131.7169 1.214742 36.48434 7.1774981</code></pre>
<p>This returns a matrix. You can see the compartment values in the plot below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">matplot</span>(x[,<span class="st">&quot;C2&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>)
<span class="kw">matplot</span>(x[,<span class="st">&quot;eff&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Effect&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="using-rxode-data-frames" class="section level5">
<h5>Using RxODE data frames</h5>
<p>You can also return a solved object that is a modified data-frame. This is done by the <code>predict()</code> or <code>solve()</code> methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">predict</span>(mod1,theta, ev, inits)
<span class="kw">print</span>(x)</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      V2      V3      KA      CL       Q     Kin    Kout    EC50 
##  40.200 297.000   0.294  18.600  10.500   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 7
##    time depot centr  peri   eff    C2    C3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0    10000     0     0  1.00   0   0    
## 2  1.00  7453  1784   273  1.08  44.4 0.920
## 3  2.00  5554  2206   794  1.18  54.9 2.67 
## 4  3.00  4140  2087  1324  1.23  51.9 4.46 
## 5  4.00  3085  1789  1776  1.23  44.5 5.98 
## 6  5.00  2299  1467  2132  1.21  36.5 7.18 
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">solve</span>(mod1,theta, ev, inits)
<span class="kw">print</span>(x)</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      V2      V3      KA      CL       Q     Kin    Kout    EC50 
##  40.200 297.000   0.294  18.600  10.500   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 7
##    time depot centr  peri   eff    C2    C3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0    10000     0     0  1.00   0   0    
## 2  1.00  7453  1784   273  1.08  44.4 0.920
## 3  2.00  5554  2206   794  1.18  54.9 2.67 
## 4  3.00  4140  2087  1324  1.23  51.9 4.46 
## 5  4.00  3085  1789  1776  1.23  44.5 5.98 
## 6  5.00  2299  1467  2132  1.21  36.5 7.18 
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>Or with <code>mattigr</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">solve</span>(theta, ev, inits)
<span class="kw">print</span>(x)</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      V2      V3      KA      CL       Q     Kin    Kout    EC50 
##  40.200 297.000   0.294  18.600  10.500   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 7
##    time depot centr  peri   eff    C2    C3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0    10000     0     0  1.00   0   0    
## 2  1.00  7453  1784   273  1.08  44.4 0.920
## 3  2.00  5554  2206   794  1.18  54.9 2.67 
## 4  3.00  4140  2087  1324  1.23  51.9 4.46 
## 5  4.00  3085  1789  1776  1.23  44.5 5.98 
## 6  5.00  2299  1467  2132  1.21  36.5 7.18 
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>The solved object acts as a <code>data.frame</code> or <code>tbl</code> that can be filtered by <code>dpylr</code>. For example you could filter it easily.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">solve</span>(theta,ev,inits) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(time <span class="op">&lt;=</span><span class="dv">3</span>)
x</code></pre></div>
<pre><code>##   time     depot    centr      peri      eff       C2        C3
## 1    0 10000.000    0.000    0.0000 1.000000  0.00000 0.0000000
## 2    1  7452.765 1783.897  273.1895 1.084664 44.37555 0.9198298
## 3    2  5554.370 2206.295  793.8758 1.180825 54.88296 2.6729825
## 4    3  4139.542 2086.518 1323.5783 1.228914 51.90343 4.4564927</code></pre>
<p>However it isn’t just a simple data object. You can use the solved object to update paramters on the fly, or even change the sampling time.</p>
<p>First we need to recreate the original solved system:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>mod1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">solve</span>(theta,ev,inits);</code></pre></div>
<p>To examine or change initial conditions, you can use the syntax <code>cmt.0</code>, <code>cmt0</code>, or <code>cmt_0</code>. In the case of the <code>eff</code> compartment defined by the model, this is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>eff0</code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>which shows the initial condition of the effect compartment. If you wished to change this initial condition to 2, this can be done easily by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>eff0 &lt;-<span class="st"> </span><span class="dv">2</span>
x</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      V2      V3      KA      CL       Q     Kin    Kout    EC50 
##  40.200 297.000   0.294  18.600  10.500   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     2</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 7
##    time depot centr  peri   eff    C2    C3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0    10000     0     0  2.00   0   0    
## 2  1.00  7453  1784   273  1.50  44.4 0.920
## 3  2.00  5554  2206   794  1.37  54.9 2.67 
## 4  3.00  4140  2087  1324  1.31  51.9 4.46 
## 5  4.00  3085  1789  1776  1.27  44.5 5.98 
## 6  5.00  2299  1467  2132  1.23  36.5 7.18 
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>Notice that the inital effect is now <code>2</code>.</p>
<p>You can also change the sampling times easily by this method by changing <code>t</code> or <code>time</code>. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>t &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dt">length.out=</span><span class="dv">20</span>)
x</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      V2      V3      KA      CL       Q     Kin    Kout    EC50 
##  40.200 297.000   0.294  18.600  10.500   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     2</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 20 x 7
##    time depot centr  peri   eff    C2     C3
## * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 0     10000     0   0    2.00   0   0     
## 2 0.263  9255   677  24.3  1.79  16.8 0.0817
## 3 0.526  8566  1187  88.7  1.65  29.5 0.299 
## 4 0.789  7929  1562 183    1.55  38.9 0.615 
## 5 1.05   7338  1830 298    1.49  45.5 1.00  
## 6 1.32   6792  2013 427    1.44  50.1 1.44  
## # ... with 14 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>You can also access or change parameters by the <code>$</code> operator. For example, accessing <code>KA</code> can be done by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>KA</code></pre></div>
<pre><code>## [1] 0.294</code></pre>
<p>And you may change it by assigning it to a new value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>KA &lt;-<span class="st"> </span><span class="dv">1</span>;
x</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##    V2    V3    KA    CL     Q   Kin  Kout  EC50 
##  40.2 297.0   1.0  18.6  10.5   1.0   1.0 200.0</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     2</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 20 x 7
##    time depot centr   peri   eff    C2    C3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0     10000     0    0    2.00   0   0    
## 2 0.263  7686  2098   77.6  1.82  52.2 0.261
## 3 0.526  5908  3348  267    1.74  83.3 0.900
## 4 0.789  4541  4010  519    1.69  99.8 1.75 
## 5 1.05   3490  4273  800    1.67 106   2.69 
## 6 1.32   2683  4272 1086    1.64 106   3.66 
## # ... with 14 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>You can access/change all the parametrs, initilizations or events with the <code>$params</code>, <code>$inits</code>, <code>$events</code> accessor syntax, similar to what is used above.</p>
<p>This syntax makes it easy to update and explore the effect of various parameters on the solved object.</p>
</div>
</div>
<div id="mixing-solved-systems-and-odes." class="section level4">
<h4>Mixing Solved Systems and ODEs.</h4>
<p>In addition to pure ODEs, you may mix solved systems and ODEs. The prior 2-compartment indirect response model can be simplified with a <code>linCmt()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2 &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    ## the order of variables do not matter, the type of compartmental
    ## model is determined by the parameters specified.
    C2   =<span class="st"> </span><span class="kw">linCmt</span>(KA, CL, V2, Q, V3);
    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span>  ## This specifies that the effect compartment starts at 1.
    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st">  </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;
})</code></pre></div>
<p>Like a Sherlock Holmes on the case of a mystery, the <code>linCmt()</code> function figures out the type of model to use based on the parameter names specified.</p>
<p>Most often, pharmacometric models are parameterized in terms of volume and clearances. Clearances are specified by NONMEM-style names of <code>CL</code>, <code>Q</code>, <code>Q1</code>, <code>Q2</code>, etc. or distributional clearances <code>CLD</code>, <code>CLD2</code>. Volumes are specified by Central (<code>VC</code> or <code>V</code>), Peripheral/Tissue (<code>VP</code>, <code>VT</code>).</p>
<p>Another popular parameterization is in terms of micro-constants. RxODE assumes compartment <code>1</code> is the central compartment. The elimination constant would be specified by <code>K</code>, <code>Ke</code> or <code>Kel</code>.</p>
<p>Once the <code>linCmt()</code> sleuthing is complete, the <code>1</code>, <code>2</code> or <code>3</code> compartment model solution is used as the value of <code>linCmt()</code>.</p>
<p>This allows the indirect response model above to assign the 2-compartment model to the <code>C2</code> variable and the used in the indirect response model.</p>
<p>When mixing the solved systems and the ODEs, the solved system’s compartment is always the last compartment. This is because the solved system technically isn’t a compartment to be solved. Adding the dosing compartment to the end will not interfere with the actual ODE to be solved.</p>
<p>Therefore,in the two-compartment indirect response model, the effect compartment is compartment #1 while the PK dosing compartment for the depot is compartment #2.</p>
<p>This compartment model requires a new event table since the compartment number changed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">'mg'</span>, <span class="dt">time.units=</span><span class="st">'hours'</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">10</span>, <span class="dt">dosing.interval=</span><span class="dv">12</span>,<span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">20000</span>, <span class="dt">nbr.doses=</span><span class="dv">5</span>, <span class="dt">start.time=</span><span class="dv">120</span>,<span class="dt">dosing.interval=</span><span class="dv">24</span>,<span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">240</span>);</code></pre></div>
<p>This can be solved with the following command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span>mod2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(theta, ev))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      KA      V2      CL       Q      V3     Kin    Kout    EC50 
##   0.294  40.200  18.600  10.500 297.000   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 3
##    time   eff    C2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0     1.00   0  
## 2  1.00  1.08  44.4
## 3  2.00  1.18  54.9
## 4  3.00  1.23  51.9
## 5  4.00  1.23  44.5
## 6  5.00  1.21  36.5
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>Note this solving did not require specifying the effect compartment initial condition to be <code>1</code>. Rather, this is already pre-specified by <code>eff(0)=1</code>.</p>
<p>This can be solved for different initial conditions easily:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span>mod2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(theta, ev,<span class="kw">c</span>(<span class="dt">eff=</span><span class="dv">2</span>)))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      KA      V2      CL       Q      V3     Kin    Kout    EC50 
##   0.294  40.200  18.600  10.500 297.000   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   2</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 3
##    time   eff    C2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0     2.00   0  
## 2  1.00  1.50  44.4
## 3  2.00  1.37  54.9
## 4  3.00  1.31  51.9
## 5  4.00  1.27  44.5
## 6  5.00  1.23  36.5
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>The RxODE detective also does not require you to specify the variables in the <code>linCmt()</code> function if they are already defined in the block.</p>
<p>Therefore, the following function will also work to solve the same system.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod3 &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    KA=<span class="fl">2.94E-01</span>;
    CL=<span class="fl">1.86E+01</span>; 
    V2=<span class="fl">4.02E+01</span>; 
    Q=<span class="fl">1.05E+01</span>;
    V3=<span class="fl">2.97E+02</span>; 
    Kin=<span class="dv">1</span>;
    Kout=<span class="dv">1</span>;
    EC50=<span class="dv">200</span>;
    ## The linCmt() picks up the variables from above
    C2   =<span class="st"> </span><span class="kw">linCmt</span>();
    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span>  ## This specifies that the effect compartment starts at 1.
    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st">  </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;
})

(x &lt;-<span class="st"> </span>mod3 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(ev))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##      KA      CL      V2       Q      V3     Kin    Kout    EC50 
##   0.294  18.600  40.200  10.500 297.000   1.000   1.000 200.000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 3
##    time   eff    C2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0     1.00   0  
## 2  1.00  1.08  44.4
## 3  2.00  1.18  54.9
## 4  3.00  1.23  51.9
## 5  4.00  1.23  44.5
## 6  5.00  1.21  36.5
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>Note that you do not specify the parameters when solving the system since they are built into the model, but you can override the parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span>mod3 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(<span class="kw">c</span>(<span class="dt">KA=</span><span class="dv">10</span>),ev))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##    KA    CL    V2     Q    V3   Kin  Kout  EC50 
##  10.0  18.6  40.2  10.5 297.0   1.0   1.0 200.0</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 241 x 3
##    time   eff    C2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  0     1.00   0  
## 2  1.00  1.34 131  
## 3  2.00  1.39  64.8
## 4  3.00  1.30  33.2
## 5  4.00  1.19  18.0
## 6  5.00  1.12  10.7
## # ... with 235 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
</div>
<div id="odes-and-covariates" class="section level4">
<h4>ODEs and covariates</h4>
<p>Covariates are easy to specify in RxODE, you can specify them as a variable. Time-varying covariates, like clock time in a circadian rhythm model, can also be used. Extending the indirect response model already discussed, we have:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod3 &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    KA=<span class="fl">2.94E-01</span>;
    CL=<span class="fl">1.86E+01</span>; 
    V2=<span class="fl">4.02E+01</span>; 
    Q=<span class="fl">1.05E+01</span>;
    V3=<span class="fl">2.97E+02</span>; 
    Kin0=<span class="dv">1</span>;
    Kout=<span class="dv">1</span>;
    EC50=<span class="dv">200</span>;
    ## The linCmt() picks up the variables from above
    C2   =<span class="st"> </span><span class="kw">linCmt</span>();
    Tz=<span class="st"> </span><span class="dv">8</span>
    amp=<span class="fl">0.1</span>
    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span>  ## This specifies that the effect compartment starts at 1.
    ## Kin changes based on time of day (like cortosol)
    Kin =<span class="st">   </span>Kin0 <span class="op">+</span>amp <span class="op">*</span><span class="kw">cos</span>(<span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>(ctime<span class="op">-</span>Tz)<span class="op">/</span><span class="dv">24</span>)
    d<span class="op">/</span><span class="kw">dt</span>(eff) =<span class="st">  </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;
})


ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">1</span>, <span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">100</span>));


 ## Create data frame of  8 am dosing for the first dose
cov.df  &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ctime =</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">100</span>)<span class="op">+</span><span class="dv">8</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">24</span>);</code></pre></div>
<p>Now there is a covariate present, the system can be solved using the cov option</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(r1 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod3, ev, <span class="dt">covs=</span>cov.df,<span class="dt">covs_interpolation=</span><span class="st">&quot;linear&quot;</span>))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##         KA         CL         V2          Q         V3       Kin0 
##   0.294000  18.600000  40.200000  10.500000 297.000000   1.000000 
##       Kout       EC50         Tz        amp         pi 
##   1.000000 200.000000   8.000000   0.100000   3.141593</code></pre>
<pre><code>## -- Covariates ($covs): ----------------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 1
##   ctime
##   &lt;dbl&gt;
## 1  8.00
## 2  8.48
## 3  8.97
## 4  9.45
## 5  9.94
## 6 10.4 
## # ... with 94 more rows</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 4
##    time   eff    C2   Kin
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0      1.00   0    1.10
## 2 0.485  1.07  27.8  1.10
## 3 0.970  1.14  43.7  1.09
## 4 1.45   1.21  51.8  1.09
## 5 1.94   1.26  54.8  1.08
## 6 2.42   1.30  54.6  1.07
## # ... with 94 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>When solving ODE equations, the solver may sample times outside of the data. When this happens, this ODE solver uses linear interpolation between the covariate values. This is the default value. It is equivalent to R’s <code>approxfun</code> with <code>method=&quot;linear&quot;</code>, which is the default <code>approxfun</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">matplot</span>(r1[,<span class="st">&quot;C2&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>)
<span class="kw">matplot</span>(r1[,<span class="st">&quot;eff&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Effect&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" width="100%" /></p>
<p>Note that the linear approximation in this case leads to some kinks in the solved system at 24-hours where the covariate has a linear interpolation between near 24 and near 0.</p>
<p>In RxODE, covariate interpolation can also be the last observation carried forward, or constant approximation. This is equivalent to R’s <code>approxfun</code> with <code>method=&quot;constant&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(r2 &lt;-<span class="st"> </span><span class="kw">solve</span>(mod3, ev, <span class="dt">covs=</span>cov.df,<span class="dt">covs_interpolation=</span><span class="st">&quot;constant&quot;</span>))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##         KA         CL         V2          Q         V3       Kin0 
##   0.294000  18.600000  40.200000  10.500000 297.000000   1.000000 
##       Kout       EC50         Tz        amp         pi 
##   1.000000 200.000000   8.000000   0.100000   3.141593</code></pre>
<pre><code>## -- Covariates ($covs): ----------------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 1
##   ctime
##   &lt;dbl&gt;
## 1  8.00
## 2  8.48
## 3  8.97
## 4  9.45
## 5  9.94
## 6 10.4 
## # ... with 94 more rows</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## eff 
##   1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 4
##    time   eff    C2   Kin
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0      1.00   0    1.10
## 2 0.485  1.07  27.8  1.10
## 3 0.970  1.15  43.7  1.09
## 4 1.45   1.21  51.8  1.09
## 5 1.94   1.27  54.8  1.08
## 6 2.42   1.30  54.6  1.07
## # ... with 94 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>which gives the following plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">matplot</span>(r2[,<span class="st">&quot;C2&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>)
<span class="kw">matplot</span>(r2[,<span class="st">&quot;eff&quot;</span>], <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Effect&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" width="100%" /></p>
<p>In this case, the plots seem to be smoother.</p>
</div>
<div id="rxode-and-transit-compartment-models" class="section level4">
<h4>RxODE and transit compartment models</h4>
<p>Savic 2008 first introduced the idea of transit compartments being a mechanistic explanation of a a lag-time type phenomena. RxODE has special handling of these models:</p>
<p>You can specify this in a similar manner as the original paper:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    ## Table 3 from Savic 2007
    cl =<span class="st"> </span><span class="fl">17.2</span> <span class="co"># (L/hr)</span>
    vc =<span class="st"> </span><span class="fl">45.1</span> <span class="co"># L</span>
    ka =<span class="st"> </span><span class="fl">0.38</span> <span class="co"># 1/hr</span>
    mtt =<span class="st"> </span><span class="fl">0.37</span> <span class="co"># hr</span>
    bio=<span class="dv">1</span>
    n =<span class="st"> </span><span class="fl">20.1</span>
    k =<span class="st"> </span>cl<span class="op">/</span>vc
    ktr =<span class="st"> </span>(n<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>mtt
    ## note that lgammafn is the same as lgamma in R.
    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(bio<span class="op">*</span>podo)<span class="op">+</span><span class="kw">log</span>(ktr)<span class="op">+</span>n<span class="op">*</span><span class="kw">log</span>(ktr<span class="op">*</span>t)<span class="op">-</span>ktr<span class="op">*</span>t<span class="op">-</span><span class="kw">lgammafn</span>(n<span class="op">+</span><span class="dv">1</span>))<span class="op">-</span>ka<span class="op">*</span>depot
    d<span class="op">/</span><span class="kw">dt</span>(cen) =<span class="st"> </span>ka<span class="op">*</span>depot<span class="op">-</span>k<span class="op">*</span>cen
})

et &lt;-<span class="st"> </span><span class="kw">eventTable</span>();
et<span class="op">$</span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="dt">length.out=</span><span class="dv">200</span>));
et<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dv">20</span>, <span class="dt">start.time=</span><span class="dv">0</span>);

transit &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, et, <span class="dt">transit_abs=</span><span class="ot">TRUE</span>)

<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="kw">with</span>(transit,<span class="kw">matplot</span>(time,cen, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>))</code></pre></div>
<p><img src="data:image/png;base64,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" width="100%" /></p>
<p>Another option is to specify the transit compartment function <code>transit</code> syntax. This specifies the parameters <code>transit(number of transit compartments, mean transit time, bioavailibility)</code>. The bioavailibity term is optional.</p>
<p>Using the <code>transit</code> code also automatically turns on the <code>transit_abs</code> option. Therefore, the same model can be specified by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    ## Table 3 from Savic 2007
    cl =<span class="st"> </span><span class="fl">17.2</span> <span class="co"># (L/hr)</span>
    vc =<span class="st"> </span><span class="fl">45.1</span> <span class="co"># L</span>
    ka =<span class="st"> </span><span class="fl">0.38</span> <span class="co"># 1/hr</span>
    mtt =<span class="st"> </span><span class="fl">0.37</span> <span class="co"># hr</span>
    bio=<span class="dv">1</span>
    n =<span class="st"> </span><span class="fl">20.1</span>
    k =<span class="st"> </span>cl<span class="op">/</span>vc
    ktr =<span class="st"> </span>(n<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>mtt
    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="st"> </span><span class="kw">transit</span>(n,mtt,bio)<span class="op">-</span>ka<span class="op">*</span>depot
    d<span class="op">/</span><span class="kw">dt</span>(cen) =<span class="st"> </span>ka<span class="op">*</span>depot<span class="op">-</span>k<span class="op">*</span>cen
})

et &lt;-<span class="st"> </span><span class="kw">eventTable</span>();
et<span class="op">$</span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="dt">length.out=</span><span class="dv">200</span>));
et<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dv">20</span>, <span class="dt">start.time=</span><span class="dv">0</span>);

transit &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, et)</code></pre></div>
<pre><code>## Warning in rxSolve(mod, et): Assumed transit compartment model since 'podo'
## is in the model.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
<span class="kw">with</span>(transit,<span class="kw">matplot</span>(time,cen, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Central Concentration&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>))</code></pre></div>
<p><img src="data:image/png;base64,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" width="100%" /></p>
</div>
<div id="stiff-odes-with-jacobian-specification" class="section level4">
<h4>Stiff ODEs with Jacobian Specification</h4>
<p>Occasionally, you may come across a <a href="https://en.wikipedia.org/wiki/Stiff_equation"><strong>stiff</strong> differential equation</a>, that is a differential equation that is numerically unstable and small variations in parameters cause different solutions to the ODEs. One way to tackle this is to choose a stiff-solver, or hybrid stiff solver (like the default LSODA). Typically this is enough. However exact Jacobian solutions may increase the stability of the ODE. (Note the Jacobian is the derivative of the ODE specification with respect to each variable). In RxODE you can specify the Jacobian with the <code>df(state)/dy(variable)=</code> statement. A classic ODE that has stiff properties under various conditions is the <a href="http://www.ece.northwestern.edu/local-apps/matlabhelp/techdoc/math_anal/diffeq6.html">van dar Pol</a> differential equations.</p>
<p>In RxODE these can be specified by the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Vtpol2 &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    d<span class="op">/</span><span class="kw">dt</span>(y)  =<span class="st"> </span>dy
    d<span class="op">/</span><span class="kw">dt</span>(dy) =<span class="st"> </span>mu<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>dy <span class="op">-</span><span class="st"> </span>y
    ## Jacobian
    <span class="kw">df</span>(y)<span class="op">/</span><span class="kw">dy</span>(dy)  =<span class="st"> </span><span class="dv">1</span>
    <span class="kw">df</span>(dy)<span class="op">/</span><span class="kw">dy</span>(y)  =<span class="st"> </span><span class="op">-</span><span class="dv">2</span><span class="op">*</span>dy<span class="op">*</span>mu<span class="op">*</span>y <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
    <span class="kw">df</span>(dy)<span class="op">/</span><span class="kw">dy</span>(dy) =<span class="st"> </span>mu<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>y<span class="op">^</span><span class="dv">2</span>)
    ## Initial conditions
    <span class="kw">y</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">2</span>
    <span class="kw">dy</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">0</span>
    ## mu
    mu =<span class="st"> </span><span class="dv">1</span> ## nonstiff; 10 moderately stiff; 1000 stiff
})

et &lt;-<span class="st"> </span><span class="kw">eventTable</span>();
et<span class="op">$</span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out=</span><span class="dv">200</span>));
et<span class="op">$</span><span class="kw">add.dosing</span>(<span class="dv">20</span>, <span class="dt">start.time=</span><span class="dv">0</span>);

(s1 &lt;-<span class="st"> </span>Vtpol2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(et, <span class="dt">method=</span><span class="st">&quot;lsoda&quot;</span>))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>## mu 
##  1</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>##  y dy 
##  2  0</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 200 x 3
##     time     y      dy
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 0       22.0  0     
## 2 0.0503  22.0 -0.0456
## 3 0.101   22.0 -0.0456
## 4 0.151   22.0 -0.0456
## 5 0.201   22.0 -0.0456
## 6 0.251   22.0 -0.0456
## # ... with 194 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>While this is not stiff at mu=1, mu=1000 is a stiff system</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(s2 &lt;-<span class="st"> </span>Vtpol2 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">solve</span>(<span class="kw">c</span>(<span class="dt">mu=</span><span class="dv">1000</span>), et))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>##   mu 
## 1000</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>##  y dy 
##  2  0</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 200 x 3
##     time     y         dy
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 0       22.0  0        
## 2 0.0503  22.0 -0.0000455
## 3 0.101   22.0 -0.0000455
## 4 0.151   22.0 -0.0000455
## 5 0.201   22.0 -0.0000455
## 6 0.251   22.0 -0.0000455
## # ... with 194 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>While this is easy enough to do, it is a bit tedious. If you have RxODE setup appropriately, that is you have:</p>
<ul>
<li><strong>Python</strong> installed in your system</li>
<li><strong>sympy</strong> installed in your system</li>
<li><strong>SnakeCharmR</strong> installed in R</li>
</ul>
<p>You can use the computer algebra system sympy to calculate the Jacobian automatically.</p>
<p>This is done by the RxODE option <code>calcJac</code> option:</p>
<pre><code>Vtpol &lt;- RxODE({
    d/dt(y)  = dy
    d/dt(dy) = mu*(1-y^2)*dy - y
    ## Initial conditions
    y(0) = 2
    dy(0) = 0
    ## mu
    mu = 1 ## nonstiff; 10 moderately stiff; 1000 stiff
}, calcJac=TRUE)
</code></pre>
<p>To see the generated model, you can use <code>rxCat</code>:</p>
<pre><code>&gt; rxCat(Vtpol)
d/dt(y)=dy;
d/dt(dy)=mu*(1-y^2)*dy-y;
y(0)=2;
dy(0)=0;
mu=1;
df(y)/dy(y)=0;
df(dy)/dy(y)=-2*dy*mu*y-1;
df(y)/dy(dy)=1;
df(dy)/dy(dy)=mu*(-Rx_pow_di(y,2)+1);
</code></pre>
</div>
<div id="simulation-of-variability-with-rxode" class="section level4">
<h4>Simulation of Variability with RxODE</h4>
<p>Variability in model parameters can be simulated by creating a matrix of parameter values for use in the simulation. In the example below, 40% variability in clearance is simulated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">42</span>);
mod &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span>
    C2 =<span class="st"> </span>centr<span class="op">/</span>V2;
    C3 =<span class="st"> </span>peri<span class="op">/</span>V3;
    CL =<span class="st">  </span>TCl<span class="op">*</span><span class="kw">exp</span>(eta.Cl) ## This is coded as a variable in the model
    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="op">-</span>KA<span class="op">*</span>depot;
    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3;
    d<span class="op">/</span><span class="kw">dt</span>(peri)  =<span class="st">                    </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3;
    d<span class="op">/</span><span class="kw">dt</span>(eff)  =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;
})

theta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">KA=</span><span class="fl">2.94E-01</span>, <span class="dt">TCl=</span><span class="fl">1.86E+01</span>, <span class="dt">V2=</span><span class="fl">4.02E+01</span>,  <span class="co"># central </span>
               <span class="dt">Q=</span><span class="fl">1.05E+01</span>, <span class="dt">V3=</span><span class="fl">2.97E+02</span>,                <span class="co"># peripheral</span>
               <span class="dt">Kin=</span><span class="dv">1</span>, <span class="dt">Kout=</span><span class="dv">1</span>, <span class="dt">EC50=</span><span class="dv">200</span>)                <span class="co"># effects  </span></code></pre></div>
<p>Each subproblem can be simulated by using the rxSolve function to run the simulation for each set of parameters of in the parameter matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## the column names of the omega matrix need to match the parameters specified by RxODE
omega &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="fl">0.4</span><span class="op">^</span><span class="dv">2</span>,<span class="dt">dimnames=</span><span class="kw">list</span>(<span class="ot">NULL</span>,<span class="kw">c</span>(<span class="st">&quot;eta.Cl&quot;</span>)))

ev &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">1</span>, <span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">100</span>));

sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod,theta,ev,<span class="dt">omega=</span>omega,<span class="dt">nSub=</span><span class="dv">100</span>)

<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(gridExtra)</code></pre></div>
<pre><code>## 
## Attaching package: 'gridExtra'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     combine</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sim,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span><span class="kw">factor</span>(sim.id))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

p2 &lt;-<span class="kw">ggplot</span>(sim,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span><span class="kw">factor</span>(sim.id))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>It is now straightforward to perform calculations and generate plots with the simulated data. Below, the 5th, 50th, and 95th percentiles of the simulated data are plotted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>);
s &lt;-sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="dt">p=</span>p, <span class="dt">eff=</span><span class="kw">quantile</span>(.<span class="op">$</span>eff, <span class="dt">probs=</span>p), 
                  <span class="dt">eff.n =</span> <span class="kw">length</span>(.<span class="op">$</span>eff), <span class="dt">eff.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>eff),
                  <span class="dt">centr=</span><span class="kw">quantile</span>(.<span class="op">$</span>centr, <span class="dt">probs=</span>p),
                  <span class="dt">centr.n=</span><span class="kw">length</span>(.<span class="op">$</span>centr),<span class="dt">centr.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>centr))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percentile=</span><span class="kw">factor</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%d%%&quot;</span>,p<span class="op">*</span><span class="dv">100</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;50%&quot;</span>,<span class="st">&quot;95%&quot;</span>)))

p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>)

p2 &lt;-<span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Note that you can see the parameters that were simulated for the example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(sim<span class="op">$</span>param)</code></pre></div>
<pre><code>##   sim.id   V2  V3  TCl      eta.Cl    KA    Q Kin Kout EC50
## 1      1 40.2 297 18.6 -0.23883576 0.294 10.5   1    1  200
## 2      2 40.2 297 18.6  0.37204656 0.294 10.5   1    1  200
## 3      3 40.2 297 18.6 -0.60662015 0.294 10.5   1    1  200
## 4      4 40.2 297 18.6 -0.08291157 0.294 10.5   1    1  200
## 5      5 40.2 297 18.6 -0.18610920 0.294 10.5   1    1  200
## 6      6 40.2 297 18.6 -0.24490319 0.294 10.5   1    1  200</code></pre>
<p>You can also supply a data-frame of parameters to simulate instead of using an omega simulation. In this contrived example we will use the previously simulated data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">theta &lt;-<span class="st"> </span>sim<span class="op">$</span>param;
(sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod,theta,ev))</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 10
##   sim.id    V2    V3   TCl  eta.Cl    KA     Q   Kin  Kout  EC50
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1  40.2   297  18.6 -0.239  0.294  10.5  1.00  1.00   200
## 2      2  40.2   297  18.6  0.372  0.294  10.5  1.00  1.00   200
## 3      3  40.2   297  18.6 -0.607  0.294  10.5  1.00  1.00   200
## 4      4  40.2   297  18.6 -0.0829 0.294  10.5  1.00  1.00   200
## 5      5  40.2   297  18.6 -0.186  0.294  10.5  1.00  1.00   200
## 6      6  40.2   297  18.6 -0.245  0.294  10.5  1.00  1.00   200
## # ... with 94 more rows</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0     1</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 10,000 x 9
##   sim.id  time depot centr  peri   eff    C2    C3    CL
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1 0         0 10000     0  1.00 249    0     14.6
## 2      1 0.485     0  7393  1083  1.22 184    3.65  14.6
## 3      1 0.970     0  5481  1866  1.36 136    6.28  14.6
## 4      1 1.45      0  4079  2430  1.42 101    8.18  14.6
## 5      1 1.94      0  3051  2833  1.42  75.9  9.54  14.6
## 6      1 2.42      0  2297  3118  1.39  57.1 10.5   14.6
## # ... with 9,994 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
<p>Even though multiple subjects were simulated, this is still a reactive data frame, meaning you can change things about the model on the fly.</p>
<p>For example, if the effect at time 0 should have been 100, you can fix this by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim<span class="op">$</span>eff0 &lt;-<span class="st"> </span><span class="dv">100</span>
sim</code></pre></div>
<pre><code>## ___________________________ Solved RxODE object ___________________________</code></pre>
<pre><code>## -- Parameters ($params): --------------------------------------------------</code></pre>
<pre><code>## # A tibble: 100 x 10
##   sim.id    V2    V3   TCl  eta.Cl    KA     Q   Kin  Kout  EC50
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1  40.2   297  18.6 -0.239  0.294  10.5  1.00  1.00   200
## 2      2  40.2   297  18.6  0.372  0.294  10.5  1.00  1.00   200
## 3      3  40.2   297  18.6 -0.607  0.294  10.5  1.00  1.00   200
## 4      4  40.2   297  18.6 -0.0829 0.294  10.5  1.00  1.00   200
## 5      5  40.2   297  18.6 -0.186  0.294  10.5  1.00  1.00   200
## 6      6  40.2   297  18.6 -0.245  0.294  10.5  1.00  1.00   200
## # ... with 94 more rows</code></pre>
<pre><code>## -- Initial Conditions ($inits): -------------------------------------------</code></pre>
<pre><code>## depot centr  peri   eff 
##     0     0     0   100</code></pre>
<pre><code>## -- First part of data (object): -------------------------------------------</code></pre>
<pre><code>## # A tibble: 10,000 x 9
##   sim.id  time depot centr  peri   eff    C2    C3    CL
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1 0         0 10000     0 100   249    0     14.6
## 2      1 0.485     0  7393  1083  79.5 184    3.65  14.6
## 3      1 0.970     0  5481  1866  61.1 136    6.28  14.6
## 4      1 1.45      0  4079  2430  45.4 101    8.18  14.6
## 5      1 1.94      0  3051  2833  32.9  75.9  9.54  14.6
## 6      1 2.42      0  2297  3118  23.2  57.1 10.5   14.6
## # ... with 9,994 more rows</code></pre>
<pre><code>## ___________________________________________________________________________</code></pre>
</div>
<div id="simulation-of-unexplained-variability" class="section level4">
<h4>Simulation of unexplained variability</h4>
<p>In addition to conveniently simulating between subject variability, you can also easily simulate unexplained variability.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">RxODE</span>({
    <span class="kw">eff</span>(<span class="dv">0</span>) =<span class="st"> </span><span class="dv">1</span>
    C2 =<span class="st"> </span>centr<span class="op">/</span>V2;
    C3 =<span class="st"> </span>peri<span class="op">/</span>V3;
    CL =<span class="st">  </span>TCl<span class="op">*</span><span class="kw">exp</span>(eta.Cl) ## This is coded as a variable in the model
    d<span class="op">/</span><span class="kw">dt</span>(depot) =<span class="op">-</span>KA<span class="op">*</span>depot;
    d<span class="op">/</span><span class="kw">dt</span>(centr) =<span class="st"> </span>KA<span class="op">*</span>depot <span class="op">-</span><span class="st"> </span>CL<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C2 <span class="op">+</span><span class="st"> </span>Q<span class="op">*</span>C3;
    d<span class="op">/</span><span class="kw">dt</span>(peri)  =<span class="st">                    </span>Q<span class="op">*</span>C2 <span class="op">-</span><span class="st"> </span>Q<span class="op">*</span>C3;
    d<span class="op">/</span><span class="kw">dt</span>(eff)  =<span class="st"> </span>Kin <span class="op">-</span><span class="st"> </span>Kout<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>C2<span class="op">/</span>(EC50<span class="op">+</span>C2))<span class="op">*</span>eff;
    e =<span class="st"> </span>eff<span class="op">+</span>eff.err
    cp =<span class="st"> </span>centr<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>cp.err)
})

theta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">KA=</span><span class="fl">2.94E-01</span>, <span class="dt">TCl=</span><span class="fl">1.86E+01</span>, <span class="dt">V2=</span><span class="fl">4.02E+01</span>,  <span class="co"># central </span>
           <span class="dt">Q=</span><span class="fl">1.05E+01</span>, <span class="dt">V3=</span><span class="fl">2.97E+02</span>,                <span class="co"># peripheral</span>
           <span class="dt">Kin=</span><span class="dv">1</span>, <span class="dt">Kout=</span><span class="dv">1</span>, <span class="dt">EC50=</span><span class="dv">200</span>)                <span class="co"># effects  </span>

sigma &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">2</span>)<span class="op">*</span><span class="fl">0.1</span>
<span class="kw">dimnames</span>(sigma) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">c</span>(<span class="st">&quot;eff.err&quot;</span>,<span class="st">&quot;cp.err&quot;</span>))


sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, theta, ev, <span class="dt">omega=</span>omega, <span class="dt">nSub=</span><span class="dv">100</span>, <span class="dt">sigma=</span>sigma)

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>);
s &lt;-sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="dt">p=</span>p, <span class="dt">eff=</span><span class="kw">quantile</span>(.<span class="op">$</span>e, <span class="dt">probs=</span>p), 
                  <span class="dt">eff.n =</span> <span class="kw">length</span>(.<span class="op">$</span>e), <span class="dt">eff.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>e),
                  <span class="dt">centr=</span><span class="kw">quantile</span>(.<span class="op">$</span>cp, <span class="dt">probs=</span>p),
                  <span class="dt">centr.n=</span><span class="kw">length</span>(.<span class="op">$</span>cp),<span class="dt">centr.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>cp))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percentile=</span><span class="kw">factor</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%d%%&quot;</span>,p<span class="op">*</span><span class="dv">100</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;50%&quot;</span>,<span class="st">&quot;95%&quot;</span>)))

p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>)

p2 &lt;-<span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --> #### Simulation of Individuals</p>
<p>Sometimes you may want to match the dosing and observations of individuals in a clinical trial. To do this you will have to create a data.frame using the <code>RxODE</code> event specification as well as an <code>ID</code> column to indicate an individual. The RxODE event vignette talks more about how these datasets should be created.</p>
<p>If you have a NONMEM/Monlix dataset and the package <code>nlmixr</code>, you can convert the <code>NONMEM`` dataset to a</code>RxODE<code>compatible dataset to use for simulation with the</code>nmDataConvert` function.</p>
<p>Instead of using nlmixr for this simple example, I will combine two RxODE event tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev1 &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">10000</span>, <span class="dt">nbr.doses=</span><span class="dv">1</span>, <span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">10</span>));

ev2 &lt;-<span class="st"> </span><span class="kw">eventTable</span>(<span class="dt">amount.units=</span><span class="st">&quot;mg&quot;</span>, <span class="dt">time.units=</span><span class="st">&quot;hours&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.dosing</span>(<span class="dt">dose=</span><span class="dv">5000</span>, <span class="dt">nbr.doses=</span><span class="dv">1</span>, <span class="dt">dosing.to=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">add.sampling</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">48</span>,<span class="dt">length.out=</span><span class="dv">8</span>));

dat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="dv">1</span>, ev1<span class="op">$</span><span class="kw">get.EventTable</span>()),
             <span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="dv">2</span>, ev2<span class="op">$</span><span class="kw">get.EventTable</span>()))


## Note the number of subject is not needed since it is determined by the data
sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, theta, dat, <span class="dt">omega=</span>omega, <span class="dt">sigma=</span>sigma)

sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id, time, e, cp)</code></pre></div>
<pre><code>##    id      time         e         cp
## 1   1  0.000000 0.8114289 6460.14796
## 2   1  5.333333 0.6014560  300.45208
## 3   1 10.666667 1.0582253  131.80838
## 4   1 16.000000 0.3831265   92.69289
## 5   1 21.333333 0.9927206  101.47790
## 6   1 26.666667 1.1512884   84.84937
## 7   1 32.000000 1.0178434   73.75433
## 8   1 37.333333 1.1434445   64.65268
## 9   1 42.666667 1.6037173   73.83733
## 10  1 48.000000 1.1671766   71.77459
## 11  2  0.000000 1.9868459   42.51513
## 12  2  6.857143 1.4072379  393.04904
## 13  2 13.714286 1.7506091   89.01406
## 14  2 20.571429 1.8330390  128.10174
## 15  2 27.428571 1.1602998   91.87640
## 16  2 34.285714 0.9143214  117.90181
## 17  2 41.142857 1.4053982   55.21662
## 18  2 48.000000 0.6576067  122.54308</code></pre>
</div>
<div id="simulation-of-clinical-trials" class="section level4">
<h4>Simulation of Clinical Trials</h4>
<p>By either using a simple single event table, or data from a clinical trial as described above, a complete clinical trial simulation can be performed.</p>
<p>Typically in clinical trial simulations you want to account for the uncertainty in the fixed parameter estimates, and even the uncertainty in both your between subject variability as well as the unexplained variability.</p>
<p><code>RxODE</code> allows you to account for these uncertainties by simulating multiple virtual “studies,” specified by the parameter <code>nStud</code>. In a single virtual study:</p>
<ul>
<li><p>A Population effect parameter is sampled from a multivariate normal distribution with mean given by the parameter estimates and the variance specified by the named matrix <code>thetaMat</code>.</p></li>
<li><p>A between subject variability/covariance matrix is sampled from either a scaled inverse chi-squared distribution (for the univariate case) or a inverse Wishart that is parameterized to scale to the conjugate prior covariance term, as described by the <a href="https://en.wikipedia.org/wiki/Scaled_inverse_chi-squared_distribution">wikipedia article</a>. (This is not the same as the <a href="http://andrewgelman.com/2012/08/22/the-scaled-inverse-wishart-prior-distribution-for-a-covariance-matrix-in-a-hierarchical-model/">scaled inverse Wishart distribution</a> ). In the case of the between subject variability, the variance/covariance matrix is given by the ‘omega’ matrix parameter and the degrees of freedom is the number of subjects in the simulation.</p></li>
<li><p>Unexplained variability is also simulated from the scaled inverse chi squared distribution or inverse Wishart distribution with the variance/covariance matrix given by the ‘sigma’ matrix parameter and the degrees of freedom given by the number of observations being simulated.</p></li>
</ul>
<p>The covariance/variance prior is simulated from <code>RxODE</code>s <code>cvPost</code> function.</p>
<p>An example of this simulation is below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Creating covariance matrix
tmp &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">8</span><span class="op">^</span><span class="dv">2</span>), <span class="dv">8</span>, <span class="dv">8</span>)
tMat &lt;-<span class="st"> </span><span class="kw">tcrossprod</span>(tmp, tmp) <span class="op">/</span><span class="st"> </span>(<span class="dv">8</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)
<span class="kw">dimnames</span>(tMat) &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="ot">NULL</span>, <span class="kw">names</span>(theta))

sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, theta, ev, <span class="dt">omega=</span>omega, <span class="dt">nSub=</span><span class="dv">100</span>, <span class="dt">sigma=</span>sigma, <span class="dt">thetaMat=</span>tMat, <span class="dt">nStud=</span><span class="dv">10</span>)

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>);
s &lt;-sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="dt">p=</span>p, <span class="dt">eff=</span><span class="kw">quantile</span>(.<span class="op">$</span>e, <span class="dt">probs=</span>p), 
                  <span class="dt">eff.n =</span> <span class="kw">length</span>(.<span class="op">$</span>e), <span class="dt">eff.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>e),
                  <span class="dt">centr=</span><span class="kw">quantile</span>(.<span class="op">$</span>cp, <span class="dt">probs=</span>p),
                  <span class="dt">centr.n=</span><span class="kw">length</span>(.<span class="op">$</span>cp),<span class="dt">centr.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>cp))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percentile=</span><span class="kw">factor</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%d%%&quot;</span>,p<span class="op">*</span><span class="dv">100</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;50%&quot;</span>,<span class="st">&quot;95%&quot;</span>)))

p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>)

p2 &lt;-<span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --> If you wish you can see what <code>omega</code> and <code>sigma</code> was used for each virtual study by accessing them in the solved data object with <code>$omega.list</code> and <code>$sigma.list</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim<span class="op">$</span>omega.list</code></pre></div>
<pre><code>## [[1]]
##           [,1]
## [1,] 0.1401636
## 
## [[2]]
##           [,1]
## [1,] 0.1423745
## 
## [[3]]
##           [,1]
## [1,] 0.1462476
## 
## [[4]]
##           [,1]
## [1,] 0.1885324
## 
## [[5]]
##           [,1]
## [1,] 0.1452799
## 
## [[6]]
##           [,1]
## [1,] 0.1426764
## 
## [[7]]
##           [,1]
## [1,] 0.1303713
## 
## [[8]]
##           [,1]
## [1,] 0.1884543
## 
## [[9]]
##           [,1]
## [1,] 0.1453168
## 
## [[10]]
##           [,1]
## [1,] 0.1514673</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim<span class="op">$</span>sigma.list</code></pre></div>
<pre><code>## [[1]]
##              [,1]         [,2]
## [1,]  0.115055008 -0.001300522
## [2,] -0.001300522  0.095544021
## 
## [[2]]
##             [,1]        [,2]
## [1,] 0.115403508 0.009912083
## [2,] 0.009912083 0.103826250
## 
## [[3]]
##              [,1]         [,2]
## [1,]  0.104344964 -0.002497709
## [2,] -0.002497709  0.104757997
## 
## [[4]]
##             [,1]        [,2]
## [1,] 0.091556183 0.005414474
## [2,] 0.005414474 0.087806016
## 
## [[5]]
##             [,1]        [,2]
## [1,] 0.092347188 0.004894803
## [2,] 0.004894803 0.091091435
## 
## [[6]]
##               [,1]          [,2]
## [1,]  0.0906104390 -0.0009193655
## [2,] -0.0009193655  0.1207593030
## 
## [[7]]
##              [,1]         [,2]
## [1,]  0.093118386 -0.008685131
## [2,] -0.008685131  0.086554102
## 
## [[8]]
##              [,1]         [,2]
## [1,]  0.117127476 -0.001171625
## [2,] -0.001171625  0.102606451
## 
## [[9]]
##             [,1]        [,2]
## [1,] 0.107491945 0.003470581
## [2,] 0.003470581 0.089015197
## 
## [[10]]
##             [,1]        [,2]
## [1,] 0.085535288 0.005263351
## [2,] 0.005263351 0.117397338</code></pre>
<p>You can also see the parameter realizations from the <code>$params</code> data frame.</p>
<p>If you do not wish to sample from the prior distributions of either the <code>omega</code> or <code>sigma</code> matrices, you can turn off this feature by specifying the <code>simVariability = FALSE</code> option when solving:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, theta, ev, <span class="dt">omega=</span>omega, <span class="dt">nSub=</span><span class="dv">100</span>, <span class="dt">sigma=</span>sigma, <span class="dt">thetaMat=</span>tMat, <span class="dt">nStud=</span><span class="dv">10</span>,
                <span class="dt">simVariability=</span><span class="ot">FALSE</span>);

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>);
s &lt;-sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="dt">p=</span>p, <span class="dt">eff=</span><span class="kw">quantile</span>(.<span class="op">$</span>e, <span class="dt">probs=</span>p), 
                  <span class="dt">eff.n =</span> <span class="kw">length</span>(.<span class="op">$</span>e), <span class="dt">eff.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>e),
                  <span class="dt">centr=</span><span class="kw">quantile</span>(.<span class="op">$</span>cp, <span class="dt">probs=</span>p),
                  <span class="dt">centr.n=</span><span class="kw">length</span>(.<span class="op">$</span>cp),<span class="dt">centr.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>cp))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percentile=</span><span class="kw">factor</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%d%%&quot;</span>,p<span class="op">*</span><span class="dv">100</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;50%&quot;</span>,<span class="st">&quot;95%&quot;</span>)))


p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>)

p2 &lt;-<span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Note since realizations of <code>omega</code> and <code>sigma</code> were not simulated, <code>$omega.list</code> and <code>$sigma.list</code> both return <code>NULL</code>.</p>
</div>
<div id="rxode-multi-threaded-solving-and-simulation" class="section level4">
<h4>RxODE multi-threaded solving and simulation</h4>
<p>RxODE now supports multi-threaded solving on OpenMP supported compilers, including linux and windows. Mac OSX can also be supported but takes <a href="https://github.com/Rdatatable/data.table/wiki/Installation#openmp-enabled-compiler-for-mac">additional setup</a>. By default it uses all your available cores for solving as determined by <code>rxCores()</code>. This may be overkill depending on your system, at a certain point the speed of solving is limited by things other than computing power.</p>
<p>You can also speed up simulation by using the multi-cores to generate random deviates with <code>mvnfast</code>. This is controlled by the <code>nCoresRV</code> parameter. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim  &lt;-<span class="st"> </span><span class="kw">rxSolve</span>(mod, theta, ev, <span class="dt">omega=</span>omega, <span class="dt">nSub=</span><span class="dv">100</span>, <span class="dt">sigma=</span>sigma, <span class="dt">thetaMat=</span>tMat, <span class="dt">nStud=</span><span class="dv">10</span>,
                <span class="dt">nCoresRV=</span><span class="dv">2</span>);

p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>);
s &lt;-sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(time) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="dt">p=</span>p, <span class="dt">eff=</span><span class="kw">quantile</span>(.<span class="op">$</span>e, <span class="dt">probs=</span>p), 
                  <span class="dt">eff.n =</span> <span class="kw">length</span>(.<span class="op">$</span>e), <span class="dt">eff.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>e),
                  <span class="dt">centr=</span><span class="kw">quantile</span>(.<span class="op">$</span>cp, <span class="dt">probs=</span>p),
                  <span class="dt">centr.n=</span><span class="kw">length</span>(.<span class="op">$</span>cp),<span class="dt">centr.avg =</span> <span class="kw">mean</span>(.<span class="op">$</span>cp))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Percentile=</span><span class="kw">factor</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%d%%&quot;</span>,p<span class="op">*</span><span class="dv">100</span>),<span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;50%&quot;</span>,<span class="st">&quot;95%&quot;</span>)))


p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,centr,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Central Concentration&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>)

p2 &lt;-<span class="kw">ggplot</span>(s,<span class="kw">aes</span>(time,eff,<span class="dt">color=</span>Percentile)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Effect&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time (hr)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">color=</span><span class="ot">FALSE</span>)

<span class="kw">grid.arrange</span>(p1,p2,<span class="dt">nrow=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The default for this is <code>1</code> core since the result depends on the number of cores and the random seed you use in your simulation. However, you can always speed up this process with more cores if you are sure your collaborators have the same number of cores available to them and have OpenMP thread-capable compile.</p>
</div>
<div id="facilities-for-generating-r-shiny-applications" class="section level4">
<h4>Facilities for generating R shiny applications</h4>
<p>An example of creating an R <a href="http://shiny.rstudio.com">shiny application</a> to interactively explore responses of various complex dosing regimens is available at <a href="http://qsp.engr.uga.edu:3838/RxODE/RegimenSimulator" class="uri">http://qsp.engr.uga.edu:3838/RxODE/RegimenSimulator</a>. Shiny applications like this one may be programmatically created with the experimental function <code>genShinyApp.template()</code>.</p>
<p>The above application includes widgets for varying the dose, dosing regimen, dose cycle, and number of cycles.</p>
<pre><code>
genShinyApp.template(appDir = &quot;shinyExample&quot;, verbose=TRUE)

library(shiny)
runApp(&quot;shinyExample&quot;)
</code></pre>
</div>
<div id="click-here-to-go-to-the-shiny-app" class="section level3">
<h3><a href="http://qsp.engr.uga.edu:3838/RxODE/RegimenSimulator">Click here to go to the Shiny App</a></h3>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
